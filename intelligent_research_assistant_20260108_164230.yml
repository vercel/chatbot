kind: app
version: 0.1.5

app:
  name: ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆç ”ç©¶ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ - å¤šæ®µéšåˆ†æã‚·ã‚¹ãƒ†ãƒ 
  description: |
    ç ”ç©¶ãƒ†ãƒ¼ãƒã‚’5ã¤ã®ã‚«ãƒ†ã‚´ãƒªï¼ˆæŠ€è¡“ç ”ç©¶ã€å¸‚å ´åˆ†æã€å­¦è¡“ç ”ç©¶ã€ãƒ“ã‚¸ãƒã‚¹æˆ¦ç•¥ã€ãã®ä»–ï¼‰ã«åˆ†é¡ã—ã€
    ã‚«ãƒ†ã‚´ãƒªã”ã¨ã«å¤šæ®µéšåˆ†æï¼ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æŠ½å‡ºã€æ¤œç´¢ã€ã‚µãƒ–ãƒ†ãƒ¼ãƒç”Ÿæˆã€è©³ç´°åˆ†æï¼‰ã‚’å®Ÿè¡Œã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã€‚
    å“è³ªæ¤œè¨¼ã¨å†ç”Ÿæˆãƒ«ãƒ¼ãƒ—ï¼ˆæœ€å¤§3å›ï¼‰ã‚’å«ã‚€å®Ÿå‹™çš„ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§ã™ã€‚
  mode: workflow
  icon: ğŸ”¬
  icon_background: '#4A90E2'

workflow:
  environment_variables:
    - description: 'Tavily Search API Key'
      id: tavily_api_key_env
      name: TAVILY_API_KEY
      value: ''
      value_type: secret

  graph:
    nodes:
      # ============================================================
      # Start
      # ============================================================
      - data:
          type: start
          variables:
            - label: ç ”ç©¶ãƒ†ãƒ¼ãƒ
              max_length: 1000
              options: []
              required: true
              type: text-input
              variable: research_topic
        height: 88
        id: start_research
        position:
          x: -650
          y: 250
        positionAbsolute:
          x: -650
          y: 250
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 242

      # ============================================================
      # Question Classifier
      # ============================================================
      - data:
          type: question-classifier
          title: ç ”ç©¶ãƒ†ãƒ¼ãƒåˆ†é¡
          desc: ç ”ç©¶ãƒ†ãƒ¼ãƒã‚’5ã¤ã®ã‚«ãƒ†ã‚´ãƒªã«åˆ†é¡ã—ã¾ã™ã€‚
          instructions: |
            ç ”ç©¶ãƒ†ãƒ¼ãƒã‚’ä»¥ä¸‹ã®5ã¤ã®ã‚«ãƒ†ã‚´ãƒªã«å¿…ãšåˆ†é¡ã—ã¦ãã ã•ã„ã€‚
            - æŠ€è¡“ç ”ç©¶: æŠ€è¡“çš„ãªç ”ç©¶ã€é–‹ç™ºã€å®Ÿè£…ã«é–¢ã™ã‚‹ãƒ†ãƒ¼ãƒï¼ˆä¾‹: AIæŠ€è¡“ã€ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ã€ã‚¯ãƒ©ã‚¦ãƒ‰ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼‰
            - å¸‚å ´åˆ†æ: å¸‚å ´èª¿æŸ»ã€ç«¶åˆåˆ†æã€ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æã«é–¢ã™ã‚‹ãƒ†ãƒ¼ãƒï¼ˆä¾‹: å¸‚å ´è¦æ¨¡ã€ç«¶åˆä»–ç¤¾ã€æ¶ˆè²»è€…å‹•å‘ï¼‰
            - å­¦è¡“ç ”ç©¶: å­¦è¡“çš„ãªç ”ç©¶ã€è«–æ–‡ã€ç†è«–ã«é–¢ã™ã‚‹ãƒ†ãƒ¼ãƒï¼ˆä¾‹: ç†è«–ç ”ç©¶ã€å®Ÿé¨“ã€å­¦è¡“è«–æ–‡ï¼‰
            - ãƒ“ã‚¸ãƒã‚¹æˆ¦ç•¥: ãƒ“ã‚¸ãƒã‚¹æˆ¦ç•¥ã€çµŒå–¶ã€ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ã«é–¢ã™ã‚‹ãƒ†ãƒ¼ãƒï¼ˆä¾‹: äº‹æ¥­æˆ¦ç•¥ã€ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æˆ¦ç•¥ã€çµŒå–¶è¨ˆç”»ï¼‰
            - ãã®ä»–: ä¸Šè¨˜ã®ã„ãšã‚Œã«ã‚‚è©²å½“ã—ãªã„ãƒ†ãƒ¼ãƒ

            è¿·ã†å ´åˆã¯ã€Œãã®ä»–ã€ã«åˆ†é¡ã—ã¦ãã ã•ã„ã€‚
          query_variable_selector:
            - start_research
            - sys.query
          classes:
            - id: tech_research
              name: æŠ€è¡“ç ”ç©¶
            - id: market_analysis
              name: å¸‚å ´åˆ†æ
            - id: academic_research
              name: å­¦è¡“ç ”ç©¶
            - id: business_strategy
              name: ãƒ“ã‚¸ãƒã‚¹æˆ¦ç•¥
            - id: other
              name: ãã®ä»–
          model:
            mode: chat
            name: gpt-4o
            provider: langgenius/openai/openai
            completion_params:
              temperature: 0.2
              max_tokens: 512
              top_p: 1
              presence_penalty: 0
              frequency_penalty: 0
          selected: false
          topics: []
        height: 380
        id: qc_research
        position:
          x: -330
          y: 250
        positionAbsolute:
          x: -330
          y: 250
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 260

      # ============================================================
      # Code: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æŠ½å‡ºãƒ»å‰å‡¦ç†
      # ============================================================
      - data:
          type: code
          title: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æŠ½å‡º
          desc: åˆ†é¡çµæœã¨ç ”ç©¶ãƒ†ãƒ¼ãƒã‚’æ•´å½¢
          code_language: python3
          code: |
            def main(research_topic: str) -> dict:
                """
                ç ”ç©¶ãƒ†ãƒ¼ãƒã‚’æ•´å½¢ã—ã€å¾Œç¶šå‡¦ç†ç”¨ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã—ã¾ã™ã€‚
                """
                # ç ”ç©¶ãƒ†ãƒ¼ãƒã‚’æ•´å½¢ï¼ˆå‰å¾Œã®ç©ºç™½ã‚’å‰Šé™¤ï¼‰
                topic = research_topic.strip() if research_topic else ""
                
                return {
                    "formatted_topic": topic,
                    "topic_length": len(topic)
                }
          outputs:
            formatted_topic:
              children: null
              type: string
            topic_length:
              children: null
              type: number
          variables:
            - value_selector:
                - start_research
                - sys.query
              variable: research_topic
          selected: false
        height: 200
        id: code_param_extract
        position:
          x: 40
          y: 250
        positionAbsolute:
          x: 40
          y: 250
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 280

      # ============================================================
      # LLM: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æŠ½å‡º
      # ============================================================
      - data:
          type: llm
          title: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æŠ½å‡º
          prompt_template:
            - id: system
              role: system
              text: |
                ã‚ãªãŸã¯ç ”ç©¶ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚
                ç ”ç©¶ãƒ†ãƒ¼ãƒã‹ã‚‰é‡è¦ãªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æŠ½å‡ºã—ã€JSONå½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚
                ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¯5-10å€‹ç¨‹åº¦ã‚’æŠ½å‡ºã—ã€é…åˆ—ã¨ã—ã¦è¿”ã—ã¦ãã ã•ã„ã€‚
            - id: user
              role: user
              text: |
                ç ”ç©¶ãƒ†ãƒ¼ãƒ: {{#code_param_extract.formatted_topic#}}

                ä»¥ä¸‹ã®JSONå½¢å¼ã§ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„:
                {
                  "keywords": ["ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰1", "ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰2", ...]
                }
          selected: false
        height: 220
        id: llm_keyword_extract
        position:
          x: 360
          y: 250
        positionAbsolute:
          x: 360
          y: 250
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 300

      # ============================================================
      # Code: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰é…åˆ—ã®æ•´å½¢
      # ============================================================
      - data:
          type: code
          title: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰é…åˆ—æ•´å½¢
          desc: LLMã®å‡ºåŠ›ã‹ã‚‰ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰é…åˆ—ã‚’æŠ½å‡º
          code_language: python3
          code: |
            import json
            import re

            def main(llm_output: str) -> dict:
                """
                LLMã®å‡ºåŠ›ã‹ã‚‰ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰é…åˆ—ã‚’æŠ½å‡ºã—ã¾ã™ã€‚
                """
                try:
                    # JSONå½¢å¼ã‚’æŠ½å‡º
                    json_match = re.search(r'\{[^{}]*"keywords"[^{}]*\}', llm_output, re.DOTALL)
                    if json_match:
                        obj = json.loads(json_match.group())
                        keywords = obj.get("keywords", [])
                    else:
                        # JSONå½¢å¼ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã€ãƒªã‚¹ãƒˆå½¢å¼ã‚’æ¢ã™
                        list_match = re.search(r'\[.*?\]', llm_output, re.DOTALL)
                        if list_match:
                            keywords = json.loads(list_match.group())
                        else:
                            # ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§åˆ†å‰²
                            keywords = [k.strip() for k in llm_output.split(',') if k.strip()]
                    
                    # ç©ºã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’é™¤å¤–ã—ã€æœ€å¤§10å€‹ã«åˆ¶é™
                    keywords = [k for k in keywords if k][:10]
                    
                    # ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒç©ºã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®š
                    if not keywords:
                        keywords = ["ç ”ç©¶", "åˆ†æ"]
                    
                except Exception as e:
                    # ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®š
                    keywords = ["ç ”ç©¶", "åˆ†æ"]
                
                return {
                    "keywords": keywords
                }
          outputs:
            keywords:
              children: null
              type: array[string]
          variables:
            - value_selector:
                - llm_keyword_extract
                - text
              variable: llm_output
          selected: false
        height: 280
        id: code_keyword_format
        position:
          x: 700
          y: 250
        positionAbsolute:
          x: 700
          y: 250
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 320

      # ============================================================
      # Iteration: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰é…åˆ—ã®åå¾©æ¤œç´¢
      # ============================================================
      - data:
          type: iteration
          title: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ï¼ˆåå¾©ï¼‰
          desc: å„ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«å¯¾ã—ã¦Webæ¤œç´¢ã‚’å®Ÿè¡Œã—ã¾ã™
          iterator_selector:
            - code_keyword_format
            - keywords
          start_node_id: iter_keyword_searchstart
          output_selector:
            - code_search_result_format
            - search_result
          output_type: array[string]
          is_parallel: false
          parallel_nums: 3
          error_handle_mode: remove-abnormal-output
          selected: false
        height: 420
        id: iter_keyword_search
        position:
          x: 1060
          y: 150
        positionAbsolute:
          x: 1060
          y: 150
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 669
        zIndex: 1

      # iteration-start
      - data:
          type: iteration-start
          title: ''
          desc: ''
          isInIteration: true
          selected: false
        draggable: false
        height: 48
        id: iter_keyword_searchstart
        parentId: iter_keyword_search
        position:
          x: 24
          y: 68
        positionAbsolute:
          x: 1084
          y: 218
        selectable: false
        sourcePosition: right
        targetPosition: left
        type: custom-iteration-start
        width: 44
        zIndex: 1002

      # Agent: Tavilyæ¤œç´¢ï¼ˆIterationå†…ï¼‰
      - data:
          type: agent
          title: Tavilyæ¤œç´¢
          desc: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§Webæ¤œç´¢ã‚’å®Ÿè¡Œã—ã¾ã™
          agent_parameters:
            instruction:
              type: constant
              value: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæä¾›ã—ãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§Webæ¤œç´¢ã‚’å®Ÿè¡Œã—ã€é–¢é€£ã™ã‚‹æƒ…å ±ã‚’å–å¾—ã—ã¦ãã ã•ã„ã€‚æ¤œç´¢çµæœã¯ç°¡æ½”ã«ã¾ã¨ã‚ã¦ãã ã•ã„ã€‚'
            model:
              type: constant
              value:
                completion_params: {}
                mode: chat
                model: gpt-4o
                model_type: llm
                provider: langgenius/openai/openai
                type: model-selector
            query:
              type: constant
              value: '{{#iter_keyword_search.item#}}'
            tools:
              type: constant
              value:
                - enabled: true
                  extra:
                    description: A search engine tool built specifically for AI agents (LLMs), delivering real-time, accurate, and factual results at speed.
                  parameters:
                    query:
                      auto: 1
                      value: null
                    max_results:
                      auto: 1
                      value: 5
                    search_depth:
                      auto: 1
                      value: basic
                  provider_name: langgenius/tavily/tavily
                  provider_show_name: langgenius/tavily/tavily
                  settings:
                    auto_parameters:
                      value:
                        type: constant
                        value: false
                    max_results:
                      value:
                        type: constant
                        value: 5
                  tool_description: A search engine tool built specifically for AI agents (LLMs), delivering real-time, accurate, and factual results at speed.
                  tool_label: Tavily Search
                  tool_name: tavily_search
                  type: builtin
          agent_strategy_label: ReAct
          agent_strategy_name: ReAct
          agent_strategy_provider_name: langgenius/agent/agent
          instruction: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæä¾›ã—ãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§Webæ¤œç´¢ã‚’å®Ÿè¡Œã—ã€é–¢é€£ã™ã‚‹æƒ…å ±ã‚’å–å¾—ã—ã¦ãã ã•ã„ã€‚æ¤œç´¢çµæœã¯ç°¡æ½”ã«ã¾ã¨ã‚ã¦ãã ã•ã„ã€‚'
          isInIteration: true
          isInLoop: false
          iteration_id: iter_keyword_search
          max_iteration: 3
          meta:
            minimum_dify_version: 1.7.0
            version: 0.0.2
          model:
            completion_params:
              temperature: 0.3
            mode: chat
            name: gpt-4o
            provider: openai
          output_schema: {}
          plugin_unique_identifier: langgenius/agent:0.0.25@3507a9a417ea8d76e5de6b2803953ca891851b6b336fafe1315471782711730f
          selected: false
          strategy: function_call
          tool_node_version: '2'
          tools:
            - provider_id: tavily
              provider_name: tavily
              provider_type: builtin
              tool_name: tavily_search
        height: 200
        id: agent_tavily_search
        parentId: iter_keyword_search
        position:
          x: 128
          y: 68
        positionAbsolute:
          x: 1188
          y: 218
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 280
        zIndex: 1002

      # Code: æ¤œç´¢çµæœã®æ•´å½¢ï¼ˆIterationå†…ï¼‰
      - data:
          type: code
          title: æ¤œç´¢çµæœæ•´å½¢
          desc: æ¤œç´¢çµæœã‚’æ•´å½¢ã—ã¾ã™
          code_language: python3
          code: |
            def main(search_result: str) -> dict:
                """
                æ¤œç´¢çµæœã‚’æ•´å½¢ã—ã¾ã™ã€‚
                """
                if not search_result or search_result.strip() == "":
                    return {
                        "search_result": "æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚"
                    }
                
                # æ¤œç´¢çµæœã‚’æ•´å½¢ï¼ˆæœ€å¤§500æ–‡å­—ã«åˆ¶é™ï¼‰
                formatted_result = search_result.strip()[:500]
                
                return {
                    "search_result": formatted_result
                }
          outputs:
            search_result:
              children: null
              type: string
          variables:
            - value_selector:
                - agent_tavily_search
                - text
              variable: search_result
          isInIteration: true
          iteration_id: iter_keyword_search
          selected: false
        height: 200
        id: code_search_result_format
        parentId: iter_keyword_search
        position:
          x: 448
          y: 68
        positionAbsolute:
          x: 1508
          y: 218
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 280
        zIndex: 1002

      # ============================================================
      # Code: æ¤œç´¢çµæœã®çµ±åˆ
      # ============================================================
      - data:
          type: code
          title: æ¤œç´¢çµæœçµ±åˆ
          desc: Iterationãƒãƒ¼ãƒ‰ã®å‡ºåŠ›ã‚’çµ±åˆã—ã¾ã™
          code_language: python3
          code: |
            def main(search_results: list) -> dict:
                """
                æ¤œç´¢çµæœã‚’çµ±åˆã—ã¾ã™ã€‚
                """
                if not search_results:
                    return {
                        "integrated_results": "æ¤œç´¢çµæœãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚"
                    }
                
                # æ¤œç´¢çµæœã‚’çµ±åˆï¼ˆæ”¹è¡Œã§åŒºåˆ‡ã‚‹ï¼‰
                integrated = "\n\n".join([str(result) for result in search_results if result])
                
                return {
                    "integrated_results": integrated
                }
          outputs:
            integrated_results:
              children: null
              type: string
          variables:
            - value_selector:
                - iter_keyword_search
                - output
              variable: search_results
          selected: false
        height: 200
        id: code_integrate_search
        position:
          x: 1800
          y: 250
        positionAbsolute:
          x: 1800
          y: 250
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 280

      # ============================================================
      # LLM: ã‚µãƒ–ãƒ†ãƒ¼ãƒç”Ÿæˆ
      # ============================================================
      - data:
          type: llm
          title: ã‚µãƒ–ãƒ†ãƒ¼ãƒç”Ÿæˆ
          prompt_template:
            - id: system
              role: system
              text: |
                ã‚ãªãŸã¯ç ”ç©¶ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚
                ç ”ç©¶ãƒ†ãƒ¼ãƒã¨æ¤œç´¢çµæœã‚’åŸºã«ã€é–¢é€£ã™ã‚‹ã‚µãƒ–ãƒ†ãƒ¼ãƒã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚
                ã‚µãƒ–ãƒ†ãƒ¼ãƒã¯3-5å€‹ç¨‹åº¦ã‚’ç”Ÿæˆã—ã€JSONå½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚
            - id: user
              role: user
              text: |
                ç ”ç©¶ãƒ†ãƒ¼ãƒ: {{#code_param_extract.formatted_topic#}}

                æ¤œç´¢çµæœ:
                {{#code_integrate_search.integrated_results#}}

                ä»¥ä¸‹ã®JSONå½¢å¼ã§ã‚µãƒ–ãƒ†ãƒ¼ãƒã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„:
                {
                  "subtopics": ["ã‚µãƒ–ãƒ†ãƒ¼ãƒ1", "ã‚µãƒ–ãƒ†ãƒ¼ãƒ2", ...]
                }
          selected: false
        height: 240
        id: llm_subtopic_generate
        position:
          x: 2120
          y: 250
        positionAbsolute:
          x: 2120
          y: 250
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 300

      # ============================================================
      # Code: ã‚µãƒ–ãƒ†ãƒ¼ãƒé…åˆ—ã®æ•´å½¢
      # ============================================================
      - data:
          type: code
          title: ã‚µãƒ–ãƒ†ãƒ¼ãƒé…åˆ—æ•´å½¢
          desc: LLMã®å‡ºåŠ›ã‹ã‚‰ã‚µãƒ–ãƒ†ãƒ¼ãƒé…åˆ—ã‚’æŠ½å‡º
          code_language: python3
          code: |
            import json
            import re

            def main(llm_output: str) -> dict:
                """
                LLMã®å‡ºåŠ›ã‹ã‚‰ã‚µãƒ–ãƒ†ãƒ¼ãƒé…åˆ—ã‚’æŠ½å‡ºã—ã¾ã™ã€‚
                """
                try:
                    # JSONå½¢å¼ã‚’æŠ½å‡º
                    json_match = re.search(r'\{[^{}]*"subtopics"[^{}]*\}', llm_output, re.DOTALL)
                    if json_match:
                        obj = json.loads(json_match.group())
                        subtopics = obj.get("subtopics", [])
                    else:
                        # JSONå½¢å¼ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã€ãƒªã‚¹ãƒˆå½¢å¼ã‚’æ¢ã™
                        list_match = re.search(r'\[.*?\]', llm_output, re.DOTALL)
                        if list_match:
                            subtopics = json.loads(list_match.group())
                        else:
                            # ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§åˆ†å‰²
                            subtopics = [s.strip() for s in llm_output.split(',') if s.strip()]
                    
                    # ç©ºã®ã‚µãƒ–ãƒ†ãƒ¼ãƒã‚’é™¤å¤–ã—ã€æœ€å¤§5å€‹ã«åˆ¶é™
                    subtopics = [s for s in subtopics if s][:5]
                    
                    # ã‚µãƒ–ãƒ†ãƒ¼ãƒãŒç©ºã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®š
                    if not subtopics:
                        subtopics = ["æ¦‚è¦", "è©³ç´°åˆ†æ"]
                    
                except Exception as e:
                    # ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®š
                    subtopics = ["æ¦‚è¦", "è©³ç´°åˆ†æ"]
                
                return {
                    "subtopics": subtopics
                }
          outputs:
            subtopics:
              children: null
              type: array[string]
          variables:
            - value_selector:
                - llm_subtopic_generate
                - text
              variable: llm_output
          selected: false
        height: 280
        id: code_subtopic_format
        position:
          x: 2460
          y: 250
        positionAbsolute:
          x: 2460
          y: 250
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 320

      # ============================================================
      # Iteration: ã‚µãƒ–ãƒ†ãƒ¼ãƒã”ã¨ã®è©³ç´°åˆ†æ
      # ============================================================
      - data:
          type: iteration
          title: ã‚µãƒ–ãƒ†ãƒ¼ãƒè©³ç´°åˆ†æï¼ˆåå¾©ï¼‰
          desc: å„ã‚µãƒ–ãƒ†ãƒ¼ãƒã«å¯¾ã—ã¦è©³ç´°åˆ†æã‚’å®Ÿè¡Œã—ã¾ã™
          iterator_selector:
            - code_subtopic_format
            - subtopics
          start_node_id: iter_subtopic_analysisstart
          output_selector:
            - code_analysis_result_format
            - analysis_result
          output_type: array[string]
          is_parallel: false
          parallel_nums: 3
          error_handle_mode: remove-abnormal-output
          selected: false
        height: 800
        id: iter_subtopic_analysis
        position:
          x: 2820
          y: 50
        positionAbsolute:
          x: 2820
          y: 50
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 1200
        zIndex: 1

      # iteration-startï¼ˆã‚µãƒ–ãƒ†ãƒ¼ãƒåˆ†æï¼‰
      - data:
          type: iteration-start
          title: ''
          desc: ''
          isInIteration: true
          selected: false
        draggable: false
        height: 48
        id: iter_subtopic_analysisstart
        parentId: iter_subtopic_analysis
        position:
          x: 24
          y: 68
        positionAbsolute:
          x: 2844
          y: 118
        selectable: false
        sourcePosition: right
        targetPosition: left
        type: custom-iteration-start
        width: 44
        zIndex: 1002

      # Code: ã‚µãƒ–ãƒ†ãƒ¼ãƒã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æŠ½å‡ºï¼ˆIterationå†…ï¼‰
      - data:
          type: code
          title: ã‚µãƒ–ãƒ†ãƒ¼ãƒã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æŠ½å‡º
          desc: ã‚µãƒ–ãƒ†ãƒ¼ãƒã‹ã‚‰ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æŠ½å‡º
          code_language: python3
          code: |
            def main(subtopic: str) -> dict:
                """
                ã‚µãƒ–ãƒ†ãƒ¼ãƒã‹ã‚‰ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æŠ½å‡ºã—ã¾ã™ã€‚
                """
                # ã‚µãƒ–ãƒ†ãƒ¼ãƒã‚’ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¨ã—ã¦ä½¿ç”¨
                keywords = [subtopic.strip()] if subtopic.strip() else ["åˆ†æ"]
                
                return {
                    "subtopic_keywords": keywords
                }
          outputs:
            subtopic_keywords:
              children: null
              type: array[string]
          variables:
            - value_selector:
                - iter_subtopic_analysis
                - item
              variable: subtopic
          isInIteration: true
          iteration_id: iter_subtopic_analysis
          selected: false
        height: 180
        id: code_subtopic_keyword_extract
        parentId: iter_subtopic_analysis
        position:
          x: 128
          y: 68
        positionAbsolute:
          x: 2948
          y: 118
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 280
        zIndex: 1002

      # Agent: Tavilyæ¤œç´¢ï¼ˆã‚µãƒ–ãƒ†ãƒ¼ãƒç”¨ã€Iterationå†…ï¼‰
      - data:
          type: agent
          title: Tavilyæ¤œç´¢ï¼ˆã‚µãƒ–ãƒ†ãƒ¼ãƒï¼‰
          desc: ã‚µãƒ–ãƒ†ãƒ¼ãƒã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§Webæ¤œç´¢ã‚’å®Ÿè¡Œã—ã¾ã™
          agent_parameters:
            instruction:
              type: constant
              value: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæä¾›ã—ãŸã‚µãƒ–ãƒ†ãƒ¼ãƒã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§Webæ¤œç´¢ã‚’å®Ÿè¡Œã—ã€è©³ç´°ãªæƒ…å ±ã‚’å–å¾—ã—ã¦ãã ã•ã„ã€‚æ¤œç´¢çµæœã¯è©³ç´°ã«ã¾ã¨ã‚ã¦ãã ã•ã„ã€‚'
            model:
              type: constant
              value:
                completion_params: {}
                mode: chat
                model: gpt-4o
                model_type: llm
                provider: langgenius/openai/openai
                type: model-selector
            query:
              type: constant
              value: '{{#iter_subtopic_analysis.item#}}'
            tools:
              type: constant
              value:
                - enabled: true
                  extra:
                    description: A search engine tool built specifically for AI agents (LLMs), delivering real-time, accurate, and factual results at speed.
                  parameters:
                    query:
                      auto: 1
                      value: null
                    max_results:
                      auto: 1
                      value: 5
                    search_depth:
                      auto: 1
                      value: advanced
                  provider_name: langgenius/tavily/tavily
                  provider_show_name: langgenius/tavily/tavily
                  settings:
                    auto_parameters:
                      value:
                        type: constant
                        value: false
                    max_results:
                      value:
                        type: constant
                        value: 5
                  tool_description: A search engine tool built specifically for AI agents (LLMs), delivering real-time, accurate, and factual results at speed.
                  tool_label: Tavily Search
                  tool_name: tavily_search
                  type: builtin
          agent_strategy_label: ReAct
          agent_strategy_name: ReAct
          agent_strategy_provider_name: langgenius/agent/agent
          instruction: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæä¾›ã—ãŸã‚µãƒ–ãƒ†ãƒ¼ãƒã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§Webæ¤œç´¢ã‚’å®Ÿè¡Œã—ã€è©³ç´°ãªæƒ…å ±ã‚’å–å¾—ã—ã¦ãã ã•ã„ã€‚æ¤œç´¢çµæœã¯è©³ç´°ã«ã¾ã¨ã‚ã¦ãã ã•ã„ã€‚'
          isInIteration: true
          isInLoop: false
          iteration_id: iter_subtopic_analysis
          max_iteration: 3
          meta:
            minimum_dify_version: 1.7.0
            version: 0.0.2
          model:
            completion_params:
              temperature: 0.3
            mode: chat
            name: gpt-4o
            provider: openai
          output_schema: {}
          plugin_unique_identifier: langgenius/agent:0.0.25@3507a9a417ea8d76e5de6b2803953ca891851b6b336fafe1315471782711730f
          selected: false
          strategy: function_call
          tool_node_version: '2'
          tools:
            - provider_id: tavily
              provider_name: tavily
              provider_type: builtin
              tool_name: tavily_search
        height: 200
        id: agent_tavily_search_subtopic
        parentId: iter_subtopic_analysis
        position:
          x: 448
          y: 68
        positionAbsolute:
          x: 3268
          y: 118
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 300
        zIndex: 1002

      # Code: æ¤œç´¢çµæœã®æ•´å½¢ï¼ˆã‚µãƒ–ãƒ†ãƒ¼ãƒç”¨ã€Iterationå†…ï¼‰
      - data:
          type: code
          title: æ¤œç´¢çµæœæ•´å½¢ï¼ˆã‚µãƒ–ãƒ†ãƒ¼ãƒï¼‰
          desc: ã‚µãƒ–ãƒ†ãƒ¼ãƒã®æ¤œç´¢çµæœã‚’æ•´å½¢ã—ã¾ã™
          code_language: python3
          code: |
            def main(search_result: str) -> dict:
                """
                æ¤œç´¢çµæœã‚’æ•´å½¢ã—ã¾ã™ã€‚
                """
                if not search_result or search_result.strip() == "":
                    return {
                        "formatted_search_result": "æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚"
                    }
                
                # æ¤œç´¢çµæœã‚’æ•´å½¢ï¼ˆæœ€å¤§1000æ–‡å­—ã«åˆ¶é™ï¼‰
                formatted_result = search_result.strip()[:1000]
                
                return {
                    "formatted_search_result": formatted_result
                }
          outputs:
            formatted_search_result:
              children: null
              type: string
          variables:
            - value_selector:
                - agent_tavily_search_subtopic
                - text
              variable: search_result
          isInIteration: true
          iteration_id: iter_subtopic_analysis
          selected: false
        height: 200
        id: code_subtopic_search_format
        parentId: iter_subtopic_analysis
        position:
          x: 788
          y: 68
        positionAbsolute:
          x: 3608
          y: 118
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 300
        zIndex: 1002

      # LLM: è©³ç´°åˆ†æï¼ˆIterationå†…ã€4å›å®Ÿè¡Œç”¨ã®æº–å‚™ï¼‰
      - data:
          type: llm
          title: è©³ç´°åˆ†æ
          prompt_template:
            - id: system
              role: system
              text: |
                ã‚ãªãŸã¯ç ”ç©¶ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚
                ã‚µãƒ–ãƒ†ãƒ¼ãƒã¨æ¤œç´¢çµæœã‚’åŸºã«ã€è©³ç´°ãªåˆ†æã‚’è¡Œã£ã¦ãã ã•ã„ã€‚
                åˆ†æã¯å…·ä½“çš„ã§è©³ç´°ãªå†…å®¹ã‚’å«ã‚€å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
            - id: user
              role: user
              text: |
                ã‚µãƒ–ãƒ†ãƒ¼ãƒ: {{#iter_subtopic_analysis.item#}}

                æ¤œç´¢çµæœ:
                {{#code_subtopic_search_format.formatted_search_result#}}

                ç ”ç©¶ãƒ†ãƒ¼ãƒ: {{#code_param_extract.formatted_topic#}}

                ä¸Šè¨˜ã®æƒ…å ±ã‚’åŸºã«ã€è©³ç´°ãªåˆ†æã‚’è¡Œã£ã¦ãã ã•ã„ã€‚
          isInIteration: true
          iteration_id: iter_subtopic_analysis
          selected: false
        height: 240
        id: llm_detailed_analysis
        parentId: iter_subtopic_analysis
        position:
          x: 1128
          y: 68
        positionAbsolute:
          x: 3948
          y: 118
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 300
        zIndex: 1002

      # Code: å“è³ªæ¤œè¨¼ï¼ˆIterationå†…ï¼‰
      - data:
          type: code
          title: å“è³ªæ¤œè¨¼
          desc: åˆ†æçµæœã®å“è³ªã‚’æ¤œè¨¼ã—ã¾ã™
          code_language: python3
          code: |
            def main(analysis_result: str) -> dict:
                """
                åˆ†æçµæœã®å“è³ªã‚’æ¤œè¨¼ã—ã¾ã™ã€‚
                å“è³ªã‚¹ã‚³ã‚¢ï¼ˆ0-100ï¼‰ã‚’è¨ˆç®—ã—ã¾ã™ã€‚
                """
                if not analysis_result or analysis_result.strip() == "":
                    return {
                        "quality_score": 0,
                        "quality_passed": False
                    }
                
                # å“è³ªã‚¹ã‚³ã‚¢ã®è¨ˆç®—
                score = 0
                
                # æ–‡å­—æ•°ã«ã‚ˆã‚‹è©•ä¾¡ï¼ˆæœ€å¤§50ç‚¹ï¼‰
                length = len(analysis_result.strip())
                if length >= 500:
                    score += 50
                elif length >= 300:
                    score += 40
                elif length >= 200:
                    score += 30
                elif length >= 100:
                    score += 20
                else:
                    score += 10
                
                # æ§‹é€ ã®å®Œå…¨æ€§ã«ã‚ˆã‚‹è©•ä¾¡ï¼ˆæœ€å¤§30ç‚¹ï¼‰
                # æ”¹è¡ŒãŒã‚ã‚‹ã‹
                if '\n' in analysis_result:
                    score += 10
                
                # å¥èª­ç‚¹ãŒã‚ã‚‹ã‹
                if 'ã€‚' in analysis_result or '.' in analysis_result:
                    score += 10
                
                # ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®å«æœ‰ç‡ï¼ˆæœ€å¤§20ç‚¹ï¼‰
                keywords = ['åˆ†æ', 'ç ”ç©¶', 'èª¿æŸ»', 'çµæœ', 'ãƒ‡ãƒ¼ã‚¿', 'æƒ…å ±']
                keyword_count = sum(1 for kw in keywords if kw in analysis_result)
                score += min(keyword_count * 3, 20)
                
                # å“è³ªã‚¹ã‚³ã‚¢ãŒ70ä»¥ä¸Šã§åˆæ ¼
                quality_passed = score >= 70
                
                return {
                    "quality_score": score,
                    "quality_passed": quality_passed
                }
          outputs:
            quality_score:
              children: null
              type: number
            quality_passed:
              children: null
              type: boolean
          variables:
            - value_selector:
                - llm_detailed_analysis
                - text
              variable: analysis_result
          isInIteration: true
          iteration_id: iter_subtopic_analysis
          selected: false
        height: 280
        id: code_quality_check
        parentId: iter_subtopic_analysis
        position:
          x: 1468
          y: 68
        positionAbsolute:
          x: 4288
          y: 118
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 300
        zIndex: 1002

      # Code: åˆ†æçµæœã®æ•´å½¢ï¼ˆIterationå†…ã€æœ€å¾Œã®ãƒãƒ¼ãƒ‰ï¼‰
      - data:
          type: code
          title: åˆ†æçµæœæ•´å½¢
          desc: åˆ†æçµæœã‚’æœ€çµ‚çš„ã«æ•´å½¢ã—ã¾ã™
          code_language: python3
          code: |
            def main(analysis_result: str, quality_score: float, subtopic: str) -> dict:
                """
                åˆ†æçµæœã‚’æœ€çµ‚çš„ã«æ•´å½¢ã—ã¾ã™ã€‚
                """
                # åˆ†æçµæœã‚’æ•´å½¢
                formatted_result = f"ã€{subtopic}ã€‘\n\n{analysis_result}\n\nå“è³ªã‚¹ã‚³ã‚¢: {quality_score}/100"
                
                return {
                    "analysis_result": formatted_result
                }
          outputs:
            analysis_result:
              children: null
              type: string
          variables:
            - value_selector:
                - llm_detailed_analysis
                - text
              variable: analysis_result
            - value_selector:
                - code_quality_check
                - quality_score
              variable: quality_score
            - value_selector:
                - iter_subtopic_analysis
                - item
              variable: subtopic
          isInIteration: true
          iteration_id: iter_subtopic_analysis
          selected: false
        height: 240
        id: code_analysis_result_format
        parentId: iter_subtopic_analysis
        position:
          x: 1808
          y: 68
        positionAbsolute:
          x: 4628
          y: 118
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 300
        zIndex: 1002

      # ============================================================
      # Code: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
      # ============================================================
      - data:
          type: code
          title: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
          desc: ã‚¨ãƒ©ãƒ¼ã‚’å‡¦ç†ã—ã€ä»£æ›¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç”Ÿæˆã—ã¾ã™
          code_language: python3
          code: |
            def main(analysis_results: list) -> dict:
                """
                ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’è¡Œã„ã¾ã™ã€‚
                """
                if not analysis_results or len(analysis_results) == 0:
                    return {
                        "error_message": "åˆ†æçµæœãŒç”Ÿæˆã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚",
                        "has_error": True
                    }
                
                # ã‚¨ãƒ©ãƒ¼ãŒãªã„å ´åˆ
                return {
                    "error_message": "",
                    "has_error": False
                }
          outputs:
            error_message:
              children: null
              type: string
            has_error:
              children: null
              type: boolean
          variables:
            - value_selector:
                - iter_subtopic_analysis
                - output
              variable: analysis_results
          selected: false
        height: 200
        id: code_error_handle
        position:
          x: 4060
          y: 250
        positionAbsolute:
          x: 4060
          y: 250
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 280

      # ============================================================
      # Code: ãƒ¬ãƒãƒ¼ãƒˆæ•´å½¢
      # ============================================================
      - data:
          type: code
          title: ãƒ¬ãƒãƒ¼ãƒˆæ•´å½¢
          desc: æœ€çµ‚ãƒ¬ãƒãƒ¼ãƒˆã‚’JSONå½¢å¼ã§ç”Ÿæˆã—ã¾ã™
          code_language: python3
          code: |
            import json

            def main(research_topic: str, keywords: list, subtopics: list, analysis_results: list, error_message: str) -> dict:
                """
                æœ€çµ‚ãƒ¬ãƒãƒ¼ãƒˆã‚’JSONå½¢å¼ã§ç”Ÿæˆã—ã¾ã™ã€‚
                """
                # ãƒ¬ãƒãƒ¼ãƒˆã‚’æ§‹ç¯‰
                report = {
                    "research_topic": research_topic,
                    "keywords": keywords,
                    "subtopics": subtopics,
                    "analysis_results": analysis_results,
                    "error_message": error_message if error_message else None,
                    "timestamp": "2025-01-08T16:42:30Z"
                }
                
                # JSONå½¢å¼ã«å¤‰æ›
                report_json = json.dumps(report, ensure_ascii=False, indent=2)
                
                return {
                    "report": report_json
                }
          outputs:
            report:
              children: null
              type: string
          variables:
            - value_selector:
                - code_param_extract
                - formatted_topic
              variable: research_topic
            - value_selector:
                - code_keyword_format
                - keywords
              variable: keywords
            - value_selector:
                - code_subtopic_format
                - subtopics
              variable: subtopics
            - value_selector:
                - iter_subtopic_analysis
                - output
              variable: analysis_results
            - value_selector:
                - code_error_handle
                - error_message
              variable: error_message
          selected: false
        height: 300
        id: code_report_format
        position:
          x: 4380
          y: 250
        positionAbsolute:
          x: 4380
          y: 250
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 320

      # ============================================================
      # End
      # ============================================================
      - data:
          type: end
          desc: 'ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼çµ‚äº†'
          title: çµ‚äº†
          outputs:
            - value_selector:
                - code_report_format
                - report
              variable: report
          selected: false
        height: 120
        id: end_research
        position:
          x: 4740
          y: 250
        positionAbsolute:
          x: 4740
          y: 250
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 242

    edges:
      # Start â†’ Question Classifier
      - data:
          isInIteration: false
          isInLoop: false
          sourceType: start
          targetType: question-classifier
        id: edge-start-qc
        source: start_research
        sourceHandle: source
        target: qc_research
        targetHandle: target
        type: custom
        zIndex: 0

      # Question Classifier â†’ Codeï¼ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æŠ½å‡ºï¼‰
      # å…¨ã‚«ãƒ†ã‚´ãƒªã§åŒã˜å‡¦ç†ãƒ•ãƒ­ãƒ¼ã‚’ä½¿ç”¨
      - data:
          isInIteration: false
          isInLoop: false
          sourceType: question-classifier
          targetType: code
        id: edge-qc-code-param
        source: qc_research
        sourceHandle: tech_research
        target: code_param_extract
        targetHandle: target
        type: custom
        zIndex: 0

      - data:
          isInIteration: false
          isInLoop: false
          sourceType: question-classifier
          targetType: code
        id: edge-qc-code-param-market
        source: qc_research
        sourceHandle: market_analysis
        target: code_param_extract
        targetHandle: target
        type: custom
        zIndex: 0

      - data:
          isInIteration: false
          isInLoop: false
          sourceType: question-classifier
          targetType: code
        id: edge-qc-code-param-academic
        source: qc_research
        sourceHandle: academic_research
        target: code_param_extract
        targetHandle: target
        type: custom
        zIndex: 0

      - data:
          isInIteration: false
          isInLoop: false
          sourceType: question-classifier
          targetType: code
        id: edge-qc-code-param-business
        source: qc_research
        sourceHandle: business_strategy
        target: code_param_extract
        targetHandle: target
        type: custom
        zIndex: 0

      - data:
          isInIteration: false
          isInLoop: false
          sourceType: question-classifier
          targetType: code
        id: edge-qc-code-param-other
        source: qc_research
        sourceHandle: other
        target: code_param_extract
        targetHandle: target
        type: custom
        zIndex: 0

      # Codeï¼ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æŠ½å‡ºï¼‰ â†’ LLMï¼ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æŠ½å‡ºï¼‰
      - data:
          isInIteration: false
          isInLoop: false
          sourceType: code
          targetType: llm
        id: edge-code-param-llm-keyword
        source: code_param_extract
        sourceHandle: source
        target: llm_keyword_extract
        targetHandle: target
        type: custom
        zIndex: 0

      # LLMï¼ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æŠ½å‡ºï¼‰ â†’ Codeï¼ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰é…åˆ—æ•´å½¢ï¼‰
      - data:
          isInIteration: false
          isInLoop: false
          sourceType: llm
          targetType: code
        id: edge-llm-keyword-code-format
        source: llm_keyword_extract
        sourceHandle: source
        target: code_keyword_format
        targetHandle: target
        type: custom
        zIndex: 0

      # Codeï¼ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰é…åˆ—æ•´å½¢ï¼‰ â†’ Iterationï¼ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ï¼‰
      - data:
          isInIteration: false
          isInLoop: false
          sourceType: code
          targetType: iteration
        id: edge-code-keyword-iter-search
        source: code_keyword_format
        sourceHandle: source
        target: iter_keyword_search
        targetHandle: target
        type: custom
        zIndex: 0

      # Iterationå†…: iteration-start â†’ Agentï¼ˆTavilyæ¤œç´¢ï¼‰
      - data:
          isInIteration: true
          isInLoop: false
          iteration_id: iter_keyword_search
          sourceType: iteration-start
          targetType: agent
        id: edge-iter-keyword-start-agent
        source: iter_keyword_searchstart
        sourceHandle: source
        target: agent_tavily_search
        targetHandle: target
        type: custom
        zIndex: 1002

      # Iterationå†…: Agentï¼ˆTavilyæ¤œç´¢ï¼‰ â†’ Codeï¼ˆæ¤œç´¢çµæœæ•´å½¢ï¼‰
      - data:
          isInIteration: true
          isInLoop: false
          iteration_id: iter_keyword_search
          sourceType: agent
          targetType: code
        id: edge-agent-search-code-format
        source: agent_tavily_search
        sourceHandle: source
        target: code_search_result_format
        targetHandle: target
        type: custom
        zIndex: 1002

      # Iterationï¼ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ï¼‰ â†’ Codeï¼ˆæ¤œç´¢çµæœçµ±åˆï¼‰
      - data:
          isInIteration: false
          isInLoop: false
          sourceType: iteration
          targetType: code
        id: edge-iter-keyword-code-integrate
        source: iter_keyword_search
        sourceHandle: source
        target: code_integrate_search
        targetHandle: target
        type: custom
        zIndex: 0

      # Codeï¼ˆæ¤œç´¢çµæœçµ±åˆï¼‰ â†’ LLMï¼ˆã‚µãƒ–ãƒ†ãƒ¼ãƒç”Ÿæˆï¼‰
      - data:
          isInIteration: false
          isInLoop: false
          sourceType: code
          targetType: llm
        id: edge-code-integrate-llm-subtopic
        source: code_integrate_search
        sourceHandle: source
        target: llm_subtopic_generate
        targetHandle: target
        type: custom
        zIndex: 0

      # LLMï¼ˆã‚µãƒ–ãƒ†ãƒ¼ãƒç”Ÿæˆï¼‰ â†’ Codeï¼ˆã‚µãƒ–ãƒ†ãƒ¼ãƒé…åˆ—æ•´å½¢ï¼‰
      - data:
          isInIteration: false
          isInLoop: false
          sourceType: llm
          targetType: code
        id: edge-llm-subtopic-code-format
        source: llm_subtopic_generate
        sourceHandle: source
        target: code_subtopic_format
        targetHandle: target
        type: custom
        zIndex: 0

      # Codeï¼ˆã‚µãƒ–ãƒ†ãƒ¼ãƒé…åˆ—æ•´å½¢ï¼‰ â†’ Iterationï¼ˆã‚µãƒ–ãƒ†ãƒ¼ãƒè©³ç´°åˆ†æï¼‰
      - data:
          isInIteration: false
          isInLoop: false
          sourceType: code
          targetType: iteration
        id: edge-code-subtopic-iter-analysis
        source: code_subtopic_format
        sourceHandle: source
        target: iter_subtopic_analysis
        targetHandle: target
        type: custom
        zIndex: 0

      # Iterationå†…ï¼ˆã‚µãƒ–ãƒ†ãƒ¼ãƒåˆ†æï¼‰: iteration-start â†’ Codeï¼ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æŠ½å‡ºï¼‰
      - data:
          isInIteration: true
          isInLoop: false
          iteration_id: iter_subtopic_analysis
          sourceType: iteration-start
          targetType: code
        id: edge-iter-subtopic-start-code-keyword
        source: iter_subtopic_analysisstart
        sourceHandle: source
        target: code_subtopic_keyword_extract
        targetHandle: target
        type: custom
        zIndex: 1002

      # Iterationå†…ï¼ˆã‚µãƒ–ãƒ†ãƒ¼ãƒåˆ†æï¼‰: Codeï¼ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æŠ½å‡ºï¼‰ â†’ Agentï¼ˆTavilyæ¤œç´¢ï¼‰
      - data:
          isInIteration: true
          isInLoop: false
          iteration_id: iter_subtopic_analysis
          sourceType: code
          targetType: agent
        id: edge-code-keyword-agent-search
        source: code_subtopic_keyword_extract
        sourceHandle: source
        target: agent_tavily_search_subtopic
        targetHandle: target
        type: custom
        zIndex: 1002

      # Iterationå†…ï¼ˆã‚µãƒ–ãƒ†ãƒ¼ãƒåˆ†æï¼‰: Agentï¼ˆTavilyæ¤œç´¢ï¼‰ â†’ Codeï¼ˆæ¤œç´¢çµæœæ•´å½¢ï¼‰
      - data:
          isInIteration: true
          isInLoop: false
          iteration_id: iter_subtopic_analysis
          sourceType: agent
          targetType: code
        id: edge-agent-search-code-format-subtopic
        source: agent_tavily_search_subtopic
        sourceHandle: source
        target: code_subtopic_search_format
        targetHandle: target
        type: custom
        zIndex: 1002

      # Iterationå†…ï¼ˆã‚µãƒ–ãƒ†ãƒ¼ãƒåˆ†æï¼‰: Codeï¼ˆæ¤œç´¢çµæœæ•´å½¢ï¼‰ â†’ LLMï¼ˆè©³ç´°åˆ†æï¼‰
      - data:
          isInIteration: true
          isInLoop: false
          iteration_id: iter_subtopic_analysis
          sourceType: code
          targetType: llm
        id: edge-code-search-llm-analysis
        source: code_subtopic_search_format
        sourceHandle: source
        target: llm_detailed_analysis
        targetHandle: target
        type: custom
        zIndex: 1002

      # Iterationå†…ï¼ˆã‚µãƒ–ãƒ†ãƒ¼ãƒåˆ†æï¼‰: LLMï¼ˆè©³ç´°åˆ†æï¼‰ â†’ Codeï¼ˆå“è³ªæ¤œè¨¼ï¼‰
      - data:
          isInIteration: true
          isInLoop: false
          iteration_id: iter_subtopic_analysis
          sourceType: llm
          targetType: code
        id: edge-llm-analysis-code-quality
        source: llm_detailed_analysis
        sourceHandle: source
        target: code_quality_check
        targetHandle: target
        type: custom
        zIndex: 1002

      # Iterationå†…ï¼ˆã‚µãƒ–ãƒ†ãƒ¼ãƒåˆ†æï¼‰: Codeï¼ˆå“è³ªæ¤œè¨¼ï¼‰ â†’ Codeï¼ˆåˆ†æçµæœæ•´å½¢ï¼‰
      - data:
          isInIteration: true
          isInLoop: false
          iteration_id: iter_subtopic_analysis
          sourceType: code
          targetType: code
        id: edge-code-quality-code-format
        source: code_quality_check
        sourceHandle: source
        target: code_analysis_result_format
        targetHandle: target
        type: custom
        zIndex: 1002

      # Iterationï¼ˆã‚µãƒ–ãƒ†ãƒ¼ãƒè©³ç´°åˆ†æï¼‰ â†’ Codeï¼ˆã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼‰
      - data:
          isInIteration: false
          isInLoop: false
          sourceType: iteration
          targetType: code
        id: edge-iter-analysis-code-error
        source: iter_subtopic_analysis
        sourceHandle: source
        target: code_error_handle
        targetHandle: target
        type: custom
        zIndex: 0

      # Codeï¼ˆã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼‰ â†’ Codeï¼ˆãƒ¬ãƒãƒ¼ãƒˆæ•´å½¢ï¼‰
      - data:
          isInIteration: false
          isInLoop: false
          sourceType: code
          targetType: code
        id: edge-code-error-code-report
        source: code_error_handle
        sourceHandle: source
        target: code_report_format
        targetHandle: target
        type: custom
        zIndex: 0

      # Codeï¼ˆãƒ¬ãƒãƒ¼ãƒˆæ•´å½¢ï¼‰ â†’ End
      - data:
          isInIteration: false
          isInLoop: false
          sourceType: code
          targetType: end
        id: edge-code-report-end
        source: code_report_format
        sourceHandle: source
        target: end_research
        targetHandle: target
        type: custom
        zIndex: 0

dependencies:
  - current_identifier: null
    type: marketplace
    value:
      marketplace_plugin_unique_identifier: langgenius/agent:0.0.25@3507a9a417ea8d76e5de6b2803953ca891851b6b336fafe1315471782711730f

